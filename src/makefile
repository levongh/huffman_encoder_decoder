include ../makefile
CC = g++
OBJDIR = ../$(OBJ_DIR)/
BINDIR = ../$(BIN_DIR)/
CPPFLAGS = -O3 -std=c++14 -Wall -Werror

COMMON_HEADERS = node.h HuffmanTree.h CoderBase.h 
COMMON_SOURCES = HuffmanTree.cpp

DECODER_HEADERS = Decoder.h 
DECODER_SOURCES = Decoder.cpp

ENCODER_HEADERS = Encoder.h
ENCODER_SOURCES = Encoder.cpp 

.PHONY: all clean
DECODER_EXECUTABLE = decode
ENCODER_EXECUTABLE = encode

DECODER_OBJECTS = $(DECODER_SOURCES:.cpp=.o)
ENCODER_OBJECTS = $(ENCODER_SOURCES:.cpp=.o)
COMMON_OBJECTS = $(COMMON_SOURCES:.cpp=.o)

$(DECODER_EXECUTABLE): $(DECODER_OBJECTS) $(COMMON_OBJECTS)
		$(CC) $(CPPFLAGS) $(DECODER_OBJECTS) $(COMMON_OBJECTS) -o $@


$(ENCODER_EXECUTABLE): $(ENCODER_OBJECTS) $(COMMON_OBJECTS)
		$(CC) $(CPPFLAGS) $(ENCODER_OBJECTS) $(COMMON_OBJECTS) -o $@

%.o : %.cpp
		$(CC) $(CPPFLAGS) $(DECODER_SOURCES) $(COMMON_SOURCES) $(ENCODER_SOURCES) -c

all: $(ENCODER_EXECUTABLE) $(DECODER_EXECUTABLE)
	mkdir -p $(OBJDIR)
	mkdir -p $(BINDIR)
	mv *.o $(OBJDIR)
	mv $(DECODER_EXECUTABLE) $(BINDIR)
	mv $(ENCODER_EXECUTABLE) $(BINDIR)

clean:
		rm -rf $(OBJDIR)/*.o $(BINDIR)/*

